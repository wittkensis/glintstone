/**
 * Split Panel Layout
 * Full-page immersive split-panel viewer for tablet detail pages
 * Purpose: Image viewer + ATF panel side-by-side with collapsible states
 * Used on: Tablet detail page
 * Dependencies: core/tokens.css
 */

/* TODO: Move to tablet folder */

/* ==========================================================================
   Full-Page Split-Panel Layout
   ========================================================================== */

/* Prevent body overflow on tablet detail pages */
body:has(.tablet-detail-page) {
    overflow-x: hidden;
    height: 100vh;
}

/* Page wrapper uses CSS Grid for pure CSS layout (2 rows) */
.tablet-detail-page {
    display: grid;
    grid-template-rows: auto 1fr;
    min-height: calc(100vh - var(--site-header-height));
    max-height: calc(100vh - var(--site-header-height));
    overflow: hidden;
}

/* Main container holds composite panel (full width) + inner content (constrained) */
.tablet-detail-page > .container {
    width: 100%;
    max-width: unset;
    padding: 0;
    background: var(--color-bg);
    position: relative;
    z-index: var(--z-elevated);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    overflow-x: hidden;
}

/* Inner container constrains header/meta width */
.container-inner {
    max-width: var(--container-base);
    width: 100%;
    margin: var(--space-2) auto;
    padding: 0 var(--space-4);
}

/* Full-page viewer fills remaining grid space */
.tablet-detail-fullpage {
    position: relative;
    width: 100%;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    min-height: 0; /* Important: prevents grid item from expanding beyond allocated space */
    background: var(--color-bg);
    z-index: var(--z-elevated);
}

/* Ensure container doesn't expand beyond grid row */
.tablet-detail-page > .container {
    min-height: 0;
}

/* Viewer container - flexbox for dynamic sizing */
.tablet-detail-viewer {
    display: flex;
    flex: 1;
    min-height: 0;
    position: relative;
}

/* ==========================================================================
   Tablet Viewer Panel
   ========================================================================== */

/* Viewer panel - dynamic width based on state */
.viewer-panel {
    position: relative;
    flex-shrink: 0;
    background: var(--color-surface);
    border-right: 1px solid var(--color-border);
    transition: width var(--transition-slower) var(--ease-in-out);
    display: flex;
    flex-direction: column;
}

/* Gradient overlay - indicates content is "below surface" when collapsed */
.viewer-panel::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to right,
        var(--color-overlay-heavy) 0%,
        var(--color-overlay-heavy) 50%,
        var(--color-overlay-heavy) 100%
    );
    pointer-events: none;
    z-index: 5;
    opacity: 0;
    transition: opacity var(--transition-slower) var(--ease-in-out);
}

/* Collapsed state: 100px thumbnail sidebar alongside ATF */
.tablet-detail-viewer[data-state="collapsed"] .viewer-panel {
    width: 100px;
    cursor: pointer;
}

/* Show overlay when collapsed - image is "beneath surface" */
.tablet-detail-viewer[data-state="collapsed"] .viewer-panel::after {
    opacity: 1;
}

/* Expanded state: 50% width */
.tablet-detail-viewer[data-state="expanded"] .viewer-panel {
    width: 50%;
}

/* Image section fills viewer panel */
.tablet-detail-viewer .tablet-image {
    position: relative; /* For absolute positioning of toggle button */
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: var(--space-4);
    background: var(--color-surface);
}

/* Collapsed state: remove padding, non-interactive thumbnail view */
.tablet-detail-viewer[data-state="collapsed"] .tablet-image {
    padding: 0;
    pointer-events: none; /* Disable interactions in collapsed state */
}

/* Expanded state: remove padding (Google Maps style) */
.tablet-detail-viewer[data-state="expanded"] .tablet-image {
    padding: 0;
    pointer-events: auto; /* Re-enable interactions in expanded state */
}

/* ==========================================================================
   Tablet Viewer Zoombox
   ========================================================================== */

/* Zoombox fills available space */
.tablet-detail-viewer .zoombox {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.tablet-detail-viewer .zoombox__viewport {
    height: auto !important; /* Override 500px fixed height */
    flex: 1;
    border-radius: 0;
    background: var(--color-bg-pure-black);
}

/* Hide zoombox controls, minimap, and image controls in collapsed state */
.tablet-detail-viewer[data-state="collapsed"] .zoombox__controls,
.tablet-detail-viewer[data-state="collapsed"] .zoombox__minimap-container,
.tablet-detail-viewer[data-state="collapsed"] .image-controls {
    display: none;
}

/* Collapsed state: fit thumbnail to width, maintain aspect ratio */
.tablet-detail-viewer[data-state="collapsed"] .zoombox__viewport {
    cursor: default; /* Remove grab cursor */
}

.tablet-detail-viewer[data-state="collapsed"] .zoombox__image {
    object-fit: contain;
    width: 100%;
    height: 100%;
}

/* ==========================================================================
   Tablet Viewer Toggle
   ========================================================================== */

/* Icon toggle based on viewer state - now controlled via data attribute on viewer container */
.viewer-toggle__icon-expand,
.viewer-toggle__icon-collapse {
    display: none;
}

.tablet-detail-viewer[data-state="collapsed"] .viewer-toggle__icon-expand {
    display: block;
}

.tablet-detail-viewer[data-state="expanded"] .viewer-toggle__icon-collapse {
    display: block;
}

/* ATF Viewer Header Toggle - More specific selectors to ensure proper icon swapping */
.atf-viewer__header .viewer-toggle .viewer-toggle__icon-expand,
.atf-viewer__header .viewer-toggle .viewer-toggle__icon-collapse {
    display: none;
}

.tablet-detail-viewer[data-state="collapsed"] .atf-viewer__header .viewer-toggle .viewer-toggle__icon-expand {
    display: block;
}

.tablet-detail-viewer[data-state="expanded"] .atf-viewer__header .viewer-toggle .viewer-toggle__icon-collapse {
    display: block;
}

/* ==========================================================================
   ATF Viewer
   ========================================================================== */

/* ATF panel fills remaining space */
.atf-panel {
    flex: 1;
    min-width: 0;
    min-height: 0;
    display: flex;
    flex-direction: column;
    background: var(--color-bg-deepest);
    overflow: hidden;
    position: relative;
}

/* ATF viewer fills panel */
.atf-panel .atf-viewer-container {
    flex: 1;
    min-height: 0;
    display: flex;
    flex-direction: row;
}

.atf-panel .atf-viewer {
    flex: 1;
    min-height: 0;
    border: none;
    border-radius: 0;
    background: var(--color-bg-deepest);
}

.atf-panel .atf-content {
    background: var(--color-bg-deepest);
}

.atf-panel .no-atf {
    background: var(--color-bg-deepest);
}

/* ==========================================================================
   ATF Viewer â€“ Tablet Viewer Toggle
   ========================================================================== */

.atf-panel > .viewer-toggle {
    position: absolute;
    top: var(--space-3);
    left: var(--space-3);
    z-index: var(--z-dropdown);
}

/* Hide standalone toggle when ATF viewer is present */
.atf-panel:has(.atf-viewer) > .viewer-toggle {
    display: none;
}

.atf-panel > .viewer-toggle .viewer-toggle__icon-expand,
.atf-panel > .viewer-toggle .viewer-toggle__icon-collapse {
    display: none;
}

.tablet-detail-viewer[data-state="collapsed"] .atf-panel > .viewer-toggle .viewer-toggle__icon-expand {
    display: block;
}

.tablet-detail-viewer[data-state="expanded"] .atf-panel > .viewer-toggle .viewer-toggle__icon-collapse {
    display: block;
}

/* ==========================================================================
   Knowledge Sidebar
   ========================================================================== */

.atf-panel .atf-dictionary {
    background: var(--color-bg-deep);
    border-left: 1px solid var(--color-border-deep);
}

.atf-panel .atf-composite-panel {
    background: var(--color-bg-deep);
    border-right: 1px solid var(--color-border-deep);
}

/* Mobile: Stack vertically */
@media (max-width: 768px) {
    .tablet-detail-viewer {
        flex-direction: column;
    }

    .tablet-detail-viewer[data-state="collapsed"] .viewer-panel,
    .tablet-detail-viewer[data-state="expanded"] .viewer-panel {
        width: 100%;
        height: 50vh;
    }

    .atf-panel {
        flex: 1;
        border-right: none;
        border-top: 1px solid var(--color-border);
    }
}

/* ==========================================================================
   Knowledge Sidebar
   ========================================================================== */

/* Print: Restore contained layout */
@media print {
    .tablet-detail-fullpage {
        height: auto;
    }

    .tablet-detail-viewer {
        flex-direction: column;
        height: auto;
    }

    .viewer-panel {
        width: 100% !important;
    }

    .viewer-toggle {
        display: none;
    }
}
